import time #import files
import board
import pwmio
import simpleio
import rotaryio
from lcd.lcd import LCD
from simple_pid import PID
from analogio import AnalogOut, AnalogIn
from digitalio import DigitalInOut, Direction, Pull
from lcd.i2c_pcf8574_interface import I2CPCF8574Interface

startBtn = DigitalInOut(board.D2) #identify button
startBtn.direction = Direciton.INPUT
startBtn.pull = Pull.UP

i2c = board.I2C() #get an i2c object
lcd = LCD(I2CPCF8574Interface(i2c, 0x27), num_rows=2, num_cols=16) #initiate LCD screen

motor1 = AnalogOut(board.A1) #motor ouput
motor2 = AnalogOut(board.A2)
photoint = DigitalInOut(board.D7) #identify photointerrupter
photoint.pull = Pull.UP

encoder = rotaryio.IncrementalEncoder(board.D3, board.D2)
last_position = 0
btn = DigitalInOut(board.D1)
btn.direction = Direction.INPUT
btn.pull = Pull.UP
state = 0
delta = 1

while True:
    position = encoder.position
    if position != last_position:
        if position > last_position:
            state = state + 1
        elif position < last_position:
            state = state - 1
        if state > 2:
            state = 2
        if state < 0:
            state = 0
        print(state)
        if state == 0: 
            lcd.clear()
            lcd.set_cursor_pos(0, 0)
            lcd.print("Go")
        elif state == 1:
            lcd.clear()
            lcd.set_cursor_pos(0, 0)
            lcd.print("Caution")
        elif state == 2:
            lcd.clear()
            lcd.set_cursor_pos(0, 0)
            lcd.print("Stop")
    if btn.value == 1:
        time.sleep(.1)
        delta = 1
    last_position = position